<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Money Mind — Save Instead</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#f0f9ff;--bg2:#e9f5ff;--panel:#fff;--ink:#0f172a;--muted:#64748b;--line:#e2e8f0;
    --primary:#2563eb;--ok:#16a34a;--accent:#22c55e;
  }
  .dark{
    --bg1:#0b1220;--bg2:#0b1220;--panel:#0f172a;--ink:#e5e7eb;--muted:#94a3b8;--line:#1f2a44;
    --primary:#4f8cff;--ok:#22c55e;--accent:#22c55e;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink)}
  header{position:sticky;top:0;z-index:100;background:linear-gradient(90deg,var(--primary),var(--accent));
          color:#fff;padding:14px 20px;box-shadow:0 2px 6px #0003;display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:20px;font-weight:800}
  .toggle{display:flex;gap:8px;align-items:center}
  main{display:grid;grid-template-columns:1fr 360px;gap:24px;padding:24px;max-width:1200px;margin:auto}
  section,aside{background:var(--panel);border-radius:16px;box-shadow:0 2px 8px #0001;padding:16px;border:1px solid var(--line)}
  input,select,button{border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-family:inherit;background:#fff;color:var(--ink)}
  .dark input,.dark select,.dark button{background:#0f1a2a;color:var(--ink);border-color:#1f2a44}
  button{cursor:pointer}
  .ok{background:var(--ok);color:#fff;border:none}
  .ghost{background:transparent;border:1px dashed var(--line);color:var(--muted)}
  .metric{background:#fef9c3;border-radius:12px;padding:10px;text-align:center;border:1px solid var(--line)}
  .dark .metric{background:#0b2238}
  .metric b{display:block;font-size:12px;color:#a16207}
  .dark .metric b{color:#93c5fd}
  .metric strong{font-size:18px}
  .barwrap{height:10px;background:#eef2f7;border-radius:999px;overflow:hidden}
  .dark .barwrap{background:#122036}
  .bar{height:100%;background:linear-gradient(90deg,var(--ok),var(--primary));transition:width .5s}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
  .asset{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);
         border-radius:12px;padding:10px;background:#fff;transition:opacity .3s ease}
  .dark .asset{background:#0f172a}
  .toast{position:fixed;right:20px;bottom:20px;background:#111827;color:#e5e7eb;border-radius:12px;padding:10px 14px;
         font-size:14px;opacity:0;transition:.25s;z-index:10000}
  .toast.show{opacity:1}
  .quote{margin-top:6px;color:#2563eb;font-style:italic;opacity:0;transition:opacity .4s}
  .quote.show{opacity:1}
  @media(max-width:900px){main{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <h1>Money Mind — Save Instead</h1>
  <label class="toggle"><input type="checkbox" id="darkToggle"><span>Dark Mode</span></label>
</header>

<main>
<section>
  <h3>Save Instead</h3>
  <div class="row">
    <input id="amount" placeholder="I skipped... e.g. 20.00" style="width:140px">
    <select id="category">
      <option>Coffee</option><option>Snacks</option><option>Clothes</option>
      <option>Gadgets</option><option>Rides</option><option>Other</option>
    </select>
  </div>
  <div class="row" style="margin-top:8px">
    <input id="note" placeholder="Reflection note (optional)" style="flex:1">
    <button id="save" class="ok">Save Instead</button>
  </div>

  <div class="metric" style="margin-top:12px"><b>Total Saved</b><strong id="mTotal">$0.00</strong></div>
  <div class="metric" style="margin-top:8px"><b>Goal</b><strong id="goalText">None</strong></div>
  <div class="barwrap" style="margin-top:4px"><div id="goalBar" class="bar" style="width:0%"></div></div>
  <div class="metric" style="margin-top:8px"><b>Streak</b><strong id="mStreak">0 days</strong></div>

  <div id="aiInsights" style="margin-top:16px;background:#f8fafc;border-radius:12px;padding:12px;border:1px solid var(--line)">
    <strong>AI Insights</strong><br>
    <div><b>Category:</b> <span id="aiCategory">—</span></div>
    <div><b>Risk:</b> <span id="aiRisk">—</span></div>
    <div><b>Impact:</b> <span id="aiImpact">—</span></div>
    <div class="quote" id="quote"></div>
  </div>

  <div style="margin-top:16px">
    <h3>With this amount you could buy…</h3>
    <div id="investGrid" class="grid"></div>
  </div>

  <h3 style="margin-top:16px">History</h3>
  <ul id="history"></ul>
</section>

<aside>
  <h3>Your Impact</h3>
  <div class="metric"><b>CO₂ Avoided</b><strong id="ecoText">0 kg</strong></div>
  <div class="barwrap"><div id="ecoBar" class="bar" style="width:0%"></div></div>
  <div class="metric" style="margin-top:10px"><b>Community Goal</b><strong id="commText">0%</strong></div>
  <div class="barwrap"><div id="commBar" class="bar" style="width:0%"></div></div>
</aside>
</main>

<div id="toast" class="toast"></div>

<script>
const $=id=>document.getElementById(id);
const QUOTES=[
 "Small wins add up fast.",
 "You just paid your future self.",
 "Skip a treat, grow a streak.",
 "Save today, thank yourself tomorrow.",
 "Consistency beats intensity.",
 "Purpose beats impulse."
];

let hist=JSON.parse(localStorage.getItem('mm_hist')||'[]');
let goal=+localStorage.getItem('mm_goal')||100;
let streak=+localStorage.getItem('mm_streak')||0;
let last=localStorage.getItem('mm_last')||null;
let communityTotal=25000;
const COMMUNITY_GOAL=100000;

function fmt(n){return '$'+Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}
function totalSaved(){return hist.reduce((s,h)=>s+Number(h.amt||0),0);}
function ymd(d){const x=new Date(d);return x.getFullYear()+'-'+(x.getMonth()+1)+'-'+x.getDate();}
function toast(msg){const t=$('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}
function classify(txt){const map={coffee:'Coffee',snack:'Snacks',shirt:'Clothes',gadget:'Gadgets',ride:'Rides'};txt=txt.toLowerCase();for(const k in map){if(txt.includes(k))return map[k];}return'Other';}
function riskScore(cat,amt){const hour=new Date().getHours();const base={Coffee:1,Snacks:2,Clothes:3,Gadgets:4,Rides:3,Other:1}[cat]||1;const late=(hour>=22||hour<=5)?2:0;const price=Math.min(amt/20,4);return Math.max(1,Math.min(10,Math.round(base+late+price)));}

function updateUI(){
 const s=totalSaved();
 const pct=Math.min(100,Math.round(s/goal*100));
 $('mTotal').textContent=fmt(s);
 $('goalText').textContent=`${fmt(goal)} target`;
 $('goalBar').style.width=pct+'%';
 $('mStreak').textContent=streak+' days';
 const eco=s*0.4;$('ecoText').textContent=eco.toFixed(1)+' kg';$('ecoBar').style.width=Math.min(100,eco/400*100)+'%';
 const comm=Math.min(100,((communityTotal+s)/COMMUNITY_GOAL)*100);$('commText').textContent=comm.toFixed(1)+'%';$('commBar').style.width=comm+'%';
 const ul=$('history');ul.innerHTML='';hist.slice().reverse().forEach(h=>{const li=document.createElement('li');li.textContent=`${new Date(h.ts).toLocaleString()} — ${fmt(h.amt)} (${h.cat})`;ul.appendChild(li);});
}

async function getQuotes(symbols){
 try{const r=await fetch('/api/quotes?symbols='+encodeURIComponent(symbols.join(',')));
 const j=await r.json();return j.data||[];}catch(e){return[];}
}
async function renderInvestGrid(amt){
 const grid=$('investGrid');const syms=['AAPL','MSFT','VOO','VTI','BTC-USD','XAU/USD','XAG/USD'];
 const data=await getQuotes(syms);
 grid.innerHTML=data.filter(d=>d&&d.price).map(d=>{
  const qty=(amt/d.price).toFixed(2);
  return `<div class="asset"><strong>${d.symbol}</strong><div>${qty} @ $${d.price.toFixed(2)}</div></div>`;
 }).join('');
}

$('save').onclick=async()=>{
 const raw=$('amount').value.replace(/[^0-9.]/g,'');
 const amt=parseFloat(raw||'0');if(!amt){toast('Enter amount');return;}
 const cat=$('category').value;const note=$('note').value.trim();
 hist.push({ts:Date.now(),amt,cat,note});localStorage.setItem('mm_hist',JSON.stringify(hist));

 // streak
 const today=ymd(new Date()),lastDay=last?ymd(new Date(+last)):null;
 if(lastDay===today){}else if(lastDay&&ymd(new Date(Date.now()-864e5))===lastDay){streak++;}else{streak=1;}
 last=String(Date.now());localStorage.setItem('mm_last',last);localStorage.setItem('mm_streak',streak);

 // AI insight + quote
 const catAI=classify(note||cat);const risk=riskScore(catAI,amt);
 $('aiCategory').textContent=catAI;
 $('aiRisk').textContent=`${risk>=8?'High':risk>=6?'Medium':'Low'} (${risk}/10)`;
 $('aiImpact').textContent=`${(amt*0.4).toFixed(1)} kg CO₂ avoided`;
 const q=QUOTES[Math.floor(Math.random()*QUOTES.length)];
 $('quote').textContent=`💡 “${q}”`;$('quote').classList.add('show');setTimeout(()=>$('quote').classList.remove('show'),4000);
 toast(`Saved ${fmt(amt)} 🎉 — “${q}”`);

 updateUI();renderInvestGrid(amt);
};

const dark=$('darkToggle');
dark.onchange=()=>{document.body.classList.toggle('dark',dark.checked);
 localStorage.setItem('mm_theme',dark.checked?'dark':'light');};
if(localStorage.getItem('mm_theme')==='dark'){dark.checked=true;document.body.classList.add('dark');}

updateUI();renderInvestGrid(25);
</script>
</body>
</html>
